{% extends 'layouts/layout.html.twig' %}
{% block extra_stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/@raruto/leaflet-elevation/dist/leaflet-elevation.css" />
{% endblock %}

{% block extra_scripts %}
    {{ parent() }}
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/@raruto/leaflet-elevation/dist/leaflet-elevation.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.7.0/gpx.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const map = L.map('map').setView([50.0, 8.0], 13);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);

            const elevationControl = L.control.elevation({
                position: "topright",
                theme: "steelblue-theme",
                detached: true,
                elevationDiv: "#elevation",
                followMarker: true
            });

            elevationControl.addTo(map);

            const gpx = new L.GPX('/gpx/osterspaier-langhalsweg.gpx', {
                async: true,
                marker_options: {
                    startIconUrl: null,
                    endIconUrl: null,
                    shadowUrl: null
                }
            }).on('loaded', function(e) {
                map.fitBounds(e.target.getBounds());
            }).on("addline", function(e) {
                elevationControl.addData(e.line);
            }).addTo(map);
        });
    </script>
{% endblock %}
    {% block content %}
        {% if blogpost is defined %}
{#            {{ dump(blogpost) }}#}
            <article class="page page-blogpost">
                {% include 'layouts/includes/navigation-main.html.twig' %}
                {# HERO #}
                <header id="hero" class="text-center">
                    {% if blogpost.imageTeaser is defined and blogpost.imageTeaser is not null %}
                        {% set heroImage = blogpost.imageTeaser.thumbnail('heroImage').html({
                            'imgAttributes': {
                                'class': 'd-none',
                                'id': 'hero-background'
                            },
                        }) %}
                        {{ heroImage|raw }}
                    {% endif %}
                    <div class="hero-content">
                        <div class="container text-start p-4">
                            <h1>{{ blogpost.title }}</h1>
                            <br>
                            <h2 class="js-toc-ignore">{{ blogpost.subTitle }}</h2>
                        </div>
                    </div>
                </header>
                {# CONTENTS #}
                <div id="title" class="container p-4 text-left">
                    <h1>{{ blogpost.title }}</h1>
                    <h2 class="js-toc-ignore">{{ blogpost.subTitle }}</h2>
                    {% if blogpost.activity is not null %}
                        {% for tag in blogpost.activity.tags %}
                            <span class="badge text-bg-secondary">{{ tag.emoji }} {{ tag.name }}</span>
                        {% endfor %}
                    {% endif %}
                </div>
                {# INTRO #}
                <div class="container p-4">
                    <div class="row">
                        <div class="col-12 col-lg-7 pt-4 intro">
                            {{ emojied(blogpost.previewText)|raw }}
                        </div>
                        {% include 'content/blogpost/aside/toc.html.twig' %}
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-7">
                            {% for item in blogpost.content %}
                                {% include 'content/blogpost/content/' ~ item.type ~ '.html.twig' with { 'item' : item } %}
                            {% endfor %}
                        </div>
                        <div class="col-12 offset-lg-1 col-lg-4">
                            {# ASIDES #}
{#                            {% if blogpost.activity is not null  and blogpost.activity.facts|length > 0%}#}
{#                                {% include 'content/blogpost/aside/facts.html.twig' %}#}
{#                            {% endif %}#}
{#                            {% include 'content/blogpost/aside/links-downloads.html.twig' %}#}
                            {% include 'content/blogpost/aside/authors.html.twig' %}
                        </div>
                    </div>
                </div>
                <div id="map" style="height: 400px;"></div>
                <div id="elevation" style="height: 200px;"></div>


                {% if tour is defined and tour is not null and tour.tourProfileAlltrails %}
                    <div class="container pl-4 pr-4">
                        <h2>{{ 'blogpost.tour.card-and-height-profile'|trans }}</h2>
                        {% include 'content/blogpost/alltrails.html.twig' %}
                    </div>
                {% endif %}
            </article>
        {% endif %}

    {% endblock %}


